<div class="successThresholdSteps">
  <div class="stepProgression">
      <div class='tabContainer-tabs'>
        <div class="connecting-line"></div>
          <ul class="nav nav-tabs" role="tablist">
              <li role="presentation" class="active" data-toggle="tooltip" title="Configure @CircuitBreaker Annotation">
                  <a href="#successThreshold-edit" aria-controls="Configure @CircuitBreaker Annotation" role="tab" >
                      <span class="round-tab">
                          <i class="glyphicon glyphicon-pencil"></i>
                      </span>
                  </a>
              </li>
              <li role="presentation" data-toggle="tooltip" title="See it in Action">
                  <a href="#successThreshold-action" aria-controls="See it in Action" role="tab">
                      <span class="round-tab">
                          <i class="glyphicon glyphicon-play"></i>
                      </span>
                  </a>
              </li>
              <li role="presentation" data-toggle="tooltip" title="Try Other Values">
                  <a href="#successThreshold-playground" aria-controls="Try Other Values" role="tab">
                      <span class="round-tab">
                          <i class="glyphicon glyphicon-cog"></i>
                      </span>
                  </a>
              </li>
          </ul>
      </div>
      <div class='tabContainer-tab-content'>
          <div id='successThreshold-edit' class='tab active'>
              <div class='editorHolder' id='sThresholdEditorHolder'>
              </div>
          </div>
          <div id='successThreshold-action' class='tab'>
              <div class='browserHolder' style='width:50%; display:inline-block;'>
              </div>
              <div class='explanationHolder' style='display:inline-block; margin-left: 20px; width:45%; vertical-align:top;'>
              </div>
              <button class='btn btn-primary selectedButton nextTabButton'>Configure it</button>
          </div>
          <div id='successThreshold-playground' class='tab'>
              <instruction style='display:inline-block'>
                  <b>Modify the @CircuitBreaker parameters</b> and <b>save the file</b> in the editor to configure your circuit breaker.
                  <br>You can simulate successful or failed requests to the microservice to see how the circuit state changes.
              </instruction> <br>
              <div class='playground'>
                  <div class='editorHolder2' id='sThresholdEditorHolder2' style='margin-top:30px; width:50%; display:inline-block;'>
                  </div>
                  <div class='playgroundHolder' style='display:inline-block; margin:30px 0 0 10px; width: 45%; vertical-align:top;'>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
<script>
    var $baselineSuccessThreshold = $('.successThresholdSteps').find('.tabContainer-tab-content');

    var content = {
        fileName: "BankService.java",
        preload: [
            "package global.eBank.microservices;",
            "import org.eclipse.microprofile.faulttolerance.CircuitBreaker;",
            "import org.eclipse.microprofile.faulttolerance.exceptions.*;",
            "",
            "public class BankService {",
            "",
            "    @CircuitBreaker(requestVolumeThreshold=8,",
            "                    failureRatio=0.25,",
            "                    delay=3000)",
            "    public Service checkBalance() {",
            "        counterForInvokingBankingService++;",
            "        return checkBalanceService();",
            "    }",
            "}"
        ],
        readonly: false,
        save: false,
        callback: "(function test(editor) {circuitBreakerCallBack.listenToEditorForAnnotationParamChange(editor); })"
    };
    var newEditor = editor.create($baselineSuccessThreshold.find('#successThreshold-edit > .editorHolder'), "ConfigureSuccessThresholdParams", content);
    contentManager.setEditor("ConfigureSuccessThresholdParams", newEditor);

    var content2 = {
        url: "https://global-ebank.com/checkBalance",
        browserContent: "circuit-breaker/check-balance-fail-with-open-circuit.html",
        callback: "(function test(webBrowser) {circuitBreakerCallBack.listenToBrowserFromHalfOpenCircuit(webBrowser); })"
    };
    var newWebBrowser = webBrowser.create($baselineSuccessThreshold.find('#successThreshold-action > .browserHolder'), "ConfigureSuccessThresholdParams",  content2);
    contentManager.setWebBrowser("ConfigureSuccessThresholdParams", newWebBrowser);

    var content2a = {
        size: "40%"
    }
    var newPod = pod.create($baselineSuccessThreshold.find('#successThreshold-action > .explanationHolder'), "ConfigureSuccessThresholdParams", content2a);
    contentManager.setPod("ConfigureSuccessThresholdParams", newPod);

    var content3 = {
        fileName: "BankService.java",
        preload: [
            "package global.eBank.microservices;",
            "import org.eclipse.microprofile.faulttolerance.CircuitBreaker;",
            "import org.eclipse.microprofile.faulttolerance.exceptions.*;",
            "",
            "public class BankService {",
            "",
            "    @CircuitBreaker(requestVolumeThreshold=8,",
            "                    failureRatio=0.25, ",
            "                    delay=3000, ",
            "                    successThreshold=2)",
            "    public Service checkBalance() {",
            "        counterForInvokingBankingService++;",
            "        return BankingService();",
            "    }",
            "}"
        ],
        readonly: [
            {
            "from": "1",
            "to": "6"
            },
            {
            "from": "11",
            "to": "15"
            }
        ],
        save: true,
        callback: "(function test(editor) {circuitBreakerCallBack.listenToEditorForCircuitBreakerAnnotationChanges(editor); })"
    };
    var newEditor2 = editor.create($baselineSuccessThreshold.find('#successThreshold-playground .editorHolder2'), "ConfigureSuccessThresholdParams", content3);
    contentManager.setEditor("ConfigureSuccessThresholdParams", newEditor2);

    var content4 = {
        content: "circuit-breaker/circuit-breaker-configure-success-threshold.html",
        callback: "(function(pod) {circuitBreakerCallBack.createCircuitBreaker(pod, 'ConfigureSuccessThresholdParams', 8, 0.25, 5000, 2)})"
    };
    var newPod1 = pod.create($baselineSuccessThreshold.find('#successThreshold-playground  .playgroundHolder'), "ConfigureSuccessThresholdParams", content4);
    contentManager.setPod("ConfigureSuccessThresholdParams", newPod1);
</script>


<script>
    //Initialize tooltips
    $('.nav-tabs > li').tooltip();
    $('.successThresholdSteps .tabContainer-tabs .nav-tabs a').on('click', function(e) {
        var liElement = $(this).parent('li');
        if (liElement.hasClass('enabled') || liElement.hasClass('active')) {
            // A enabled element may be selected when clicked on
            var currentAttrValue = $(this).attr('href');
            // show/hide tabs
            $('.successThresholdSteps .tabContainer-tab-content ' + currentAttrValue).slideDown(400).siblings().slideUp(400);
            // change/remove current tab to active
            $(this).parent('li').addClass('active').siblings().removeClass('active');
        }

        e.preventDefault();
    });
    $('.successThresholdSteps .tabContainer-tabs .nav-tabs li').first().addClass('enabled');
    $('.successThresholdSteps .tabContainer-tabs .nav-tabs a').first().click();
    $('.nextTabButton').on('click', function(e) {
        var stepPod = contentManager.getPod("ConfigureSuccessThresholdParams", 2).accessPodContent();
        var breadcrumbElement = stepPod.find('.successThresholdSteps > .stepProgression > X.tabContainer-tabs > .nav-tabs');
        var activeStep = breadcrumbElement.find('li.active');
        activeStep.next().find('a').click();
    });
</script>
